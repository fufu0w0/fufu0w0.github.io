---
title: 网络安全的理论与实践
date: 2020-6-1 22:34:20
updated: 2020-6-1 22:34:20
categories: 
- 安全
tags: 
- 网络安全
- 密码学
- 数据认证
- 笔记
mathjax: true
---

网络安全概论课程复习笔记。

## 概论

### 常见攻击手段

* 窃听：网络数据包嗅探
  解决途径：数据加密
* 窃取登录密码
  * 密码猜测
  * 社交工程，用社交手段获取私密信息
    * 身份伪装
    * 钓鱼：伪造网站(称之为钓鱼网站)进行的攻击，最常见
  * 字典攻击：登录密码加密后存储在主机中，将密码密文和存储了密码的字典对碰
    * 构造彩虹表节省空间
  * 密码嗅探
* 身份诈骗
  * 中间人攻击
    解决途径：验证ip包
![20200311112018.png](https://cdn.jsdelivr.net/gh/fufu0w0/myblogpic/20200311112018.png)
  * 重放攻击：拦截一个合法的信息，经过一段时间后重新将此消息发给最初的接受者
    解决途径：给每次发出的消息加上一个随机数或时间戳(timestamp)
  * 网络诈骗
  * 软件剥削
* 网络诈骗
  * ip诈骗是最常见的
  * SYN洪水攻击
  * TCP劫持
  * `ARP`诈骗
    * address resolution protoco，将ip地址转为MAC地址
    * 篡改目的主机的APR表
    ![20200313110936.png](https://cdn.jsdelivr.net/gh/fufu0w0/myblogpic/20200313110936.png)
* 缓冲区溢出的攻击
 解决途径：进行语句检查并检查要写入缓冲区的内容的界限
* 抵赖
  解决途径：身份认证协议
* 入侵：未授权用户进入他人计算机系统
  解决途径：身份认证协议
* 流量分析
* 拒绝服务攻击`Denial of Service`
  * Dos：由单台计算机发起攻击
  * DDos：由多台计算机发起攻击
* 恶意软件
  * 病毒
  * 蠕虫
  * 特洛伊木马
  * 逻辑炸弹
  * 后门程序
  * 间谍软件
* 逻辑炸弹：在程序内的子程序或指令，当一定的条件满足后，会触发执行

### 网络安全基本模型

* 密码系统
* 防火墙
* 抗恶意软件(AMS software)
* 入侵检测系统 (IDS)

## 数据加密算法

### 加密算法设计要求

* 高效
  * 时间复杂度在输入规模常数倍以内
  * 最简单的事异或运算加密，明文和密钥做异或运算后得到密文
* 抵御统计分析
  * 扩散性，明文中每个比特影响密文中的多个比特，密文中的每个比特都由明文中的多个比特决定
  * 混淆性，密钥中每个比特影响密文中的多个比特，密文中的每个比特都由密钥中的多个比特决定
* 抵御穷举攻击
* 抵御侧信道攻击（side channel attack, SCA）
* 抵御数学攻击
  * 数学方法破译加密信息
  * 差分分析
  * 线性分析

### 数据加密标准DES

* DES，Data Encryption Standard，是迭代的，对称的加密算法
* Feistel密码体系(FCS)的具体实施
  * 明文分为多个`2l`长的字符串,用替换和异或对每个字符串加密
  * 密钥`K`产生`n`个子密钥
  * `2l`的明文分为长度相同的`L0`和`R0`，经过`n`次替换和异或后的到这个`2l`的密文
  * 密文和明文等长
  * 解密和加密是对称的，输入密文和密钥，经过`n`轮替换和异或运算后得到解密后的明文
  ![FCSJIAMI.PNG](https://cdn.jsdelivr.net/gh/fufu0w0/myblogpic/FCSJIAMI.PNG)
* DES的替换函数`F`依赖于一组被称为S盒的特殊的矩阵
  * 48bit的字符串`Y`，
  * 按顺序分为8个6bit长的字符串，
  * 用8个4*16的**互不相同**的S盒转换为4bit字符串作为输出
* 加密算法
  * 将32bit字符串通过扩展置换EP置换为48bit字符串
  * 将48bit字符串和密钥$K_i$做异或
  * 将该字符串输入S函数(就是上面的S盒)，得到32bit字符串
  * 将该字符串重新排列
  * 上述过程用公式表达如下
    $F(R_{i-1},K_i)=P(S(EP(R_{i-1})\bigotimes K_i))$
* 安全强度取决于加密算法论述，密钥长度，替换函数构造

### AES加密算法

* 基本结构
  * AES，Advanced Encryption Standard，是迭代的，对称的加密算法
  * 以字节为单位，将明文分段，每段16字节，表示为4*4的**状态矩阵**
  * 每轮加密算法有字节替换`sub`，行位移`shr`，列混合`mic`和子密钥相加`ark`
  * 重复执行加密算法将明文状态矩阵转为密文状态矩阵
  * 密钥长度可以是16B,24B,32B，子密钥都是16B
* AES-128加密算法步骤
  * 将密钥扩展为44个元素的数组W，每个元素是32bit字符串，将W分成11个128bit子密钥（32bit\*44=128bit\*11)，也就是将密钥扩展为11把16字节的子密钥
  * 子密钥的产生和字节替换都依赖同一S盒，S盒是16*16矩阵，每个元素都是1字节的二进制序列，是一一对应的置换
    * 需要替换的字节w，一个字节8bit,i为前4bit的，j为后4bit,$S(w)=s_{i,j}$,i，j属于[0,16)，$s_{i,j}$是S盒中对应的元素
    ![20200320110820.png](https://cdn.jsdelivr.net/gh/fufu0w0/myblogpic/20200320110820.png)
    * w经过S盒再经过S逆盒后得到w,w经过S逆盒再经过S盒后得到w
    $S(S^{-1}(w))=w$  
    $S^{-1}(S(w))=w$
    * S盒的构造用了加瓦罗域的乘法运算
  * 子密钥扩展
    * 将16B的密钥扩展为每个元素4字节，共有44个元素的W数组，W[4i][4i+1][4i+2][4i+3]是第i个子密钥
    * 前4个字节是这个密钥自己，后面40个用前面4个来产生
    ![20200320113126.png](https://cdn.jsdelivr.net/gh/fufu0w0/myblogpic/20200320113126.png)
    * 具体过程P58自己看
  * 子密钥相加ark (Add Round Keys)
    将16字节的子密钥排列为4*4的矩阵$K_i$，和当前的状态矩阵A按位异或
    $ark(A,K_i)=A\bigoplus K_i$
  * 字节替换sub (Substitute-Bytes)
    将当前状态矩阵A按位输入S盒进行替换
    $sub(S)=[S(a_{ij})]_{4\times4}$
  * 行位移shr (Shift-Rows)
    将A的第i行向左循环位移i-1次，逆运算是将A的第i行向右循环位移i-1次
    shr运算是可逆的
    $shr(shr^{-1}(A))=A$
  * 列混合mic (Mix-Columns)
    对当前状态数组每一列的元素做混合运算

    $mic(A)=[a'_{ij}]_{4\times4}$

    ![20200320125155.png](https://cdn.jsdelivr.net/gh/fufu0w0/myblogpic/20200320125155.png)
    mic运算时可逆的
    $mic(mic^{-1}(A))=A$

## 实用网络安全协议

密码算法部署在网络不通层会提供不同的保护。

* 应用层：端到端加密，传输过程不解密
* 传输层：封装数据的 tcp 包被加密，包括数据和首部，在传输过程中经过传输层时需要解密。
* 网络层：tcp 包被加密，封装 tcp 包的 ip 包也可以在这里加密和认证，是链到链加密，原始 ip 包对 ip 层可见，分为隧道模式和传输模式两种。

### 传输层安全协议 SSH/TLS

SSL：安全套接字层协议

>The SSL record protocol is responsible for data encryption and integrity.

结构

* SSL握手协议
  * session：客户端和服务器之间的关联，它定义了一组参数，如使用的算法、sessionId等。SSL会话由SSL握手协议创建。该协议允许在服务器和客户机之间建立的连接（conection）之间共享参数，用于避免为每个连接协商新参数。也就是说，客户机和服务器之间的多个SSL连接之间共享单个会话。
* SSL记录协议
  * 分段
  * 用SSL握手协议中确定的压缩函数，MAC算法，（Message Authentication Code）
  ![20200506102044](https://cdn.jsdelivr.net/gh/fufu0w0/myblogpic/20200506102044.png)
* SSL密码更换协议
* SSL提醒协议
![20200506100905](https://cdn.jsdelivr.net/gh/fufu0w0/myblogpic/20200506100905.png)

TLS：传输层安全性协议

### 网络层安全协议标准

网络层安全协议标准是 ip 安全协议`IPsec`，是构造虚拟专用网络的主要工具。

IPsec将 tcp 包加密

* 认证协议
  * 认证头，Authentication Header，`AH`
  * 用于 ip 包的**认证**
  * 认证 ip 包来源，,using a shared secret key to create the message digest
  * 保证 ip 包数据完整性, using a message digest that is generated by an algorithm such as HMAC-MD5 or HMAC-SHA.
  * AH使用滑动窗口抵御消息重放攻击
* 加密协议
  * 封装安全荷载，Encapsulating Security Payload，`ESP`
  * 规定加密格式，用于 ip 包的**加密**和**认证**
* 密钥交换协议
  * 互联网密钥交换，Internet Key Echange，`IKE`
  * 规定密钥交换格式，给通信双方设置密钥
* 安全关联机制
  * 安全关联机制，`SA`
  * 要处理 IPsec 加密或认证的 IP 包，通信双方要建立一个安全连接。发送端选择加密算法和参数，要通知接收端用相同的加密算法和参数解密收到的网包
  * 安全参数索引`SPI`，安全参数在安全关联数据库 (security associations database, SADB)中的索引
  * 目标ip地址
  * 安全标识符，AH 或 ESP

对ip包加密主要是以下两种方式：

* 隧道模式 `tunnel mode`，对整个 ip 包，包括 ip 包首部加密
  * IPsec 将原始 ip 包用 AH 或 ESP 封装
  * 用新的 ip 首部包装装封装后的ip包
  * 单层隧道，网关G收到 ip 包，和发送这个 ip 包的网关建立安全连接 SA，解密该 ip 包，获取目标 ip 地址，在路由表中查询到下一跳的网关 ip，用这个 ip 作为新的 ip 包首部
  * 多层隧道
    * 接收端IPsec对收到的数据包解密

    ![20200429112020](https://cdn.jsdelivr.net/gh/fufu0w0/myblogpic/20200429112020.png)
    AH模式↑

    ![20200429112453](https://cdn.jsdelivr.net/gh/fufu0w0/myblogpic/20200429112453.png)
    ESP模式↑

  * 传输模式 `Transport mode`，不对 ip 包首部进行加密。在AH或ESP加密后，用原来的ip首部作为新的首部封装即可。
  
AH只用于认证，ESP可以用于加密，也可以用于认证。
ESP尾部包含认证，头部有序列号，原始ip包部分加密。

## 数据认证

目的是

* 证明数据来自哪儿
* 证明数据未被篡改
* 维护数据完整性和不可否认性

明文较长时，加密算法耗费大，因此在实际中一般从明文生成一个较短的字符串加密，有使用密钥和不使用密钥两种生成方式

* 使用密钥生成的短代表，叫做**数字签名**
* 不用密钥生成的短代表，叫做**消息认证码**

### 散列函数

要求：

* 单项性
* 计算唯一性
  * 无碰撞性
  * 强无碰撞性

标准安全散列函数有

* SHA
  * SHA-512
  * SHA-3标准
* 旋涡散列函数

### 消息认证码

消息认证码，Message authentication code，`MCN`，也叫**密码校验和**，一般用常规加密算法产生密码校验和来做数据认证。

**异或密码校验和**

$M=M_1M_2...M_k$是明文，$M_i$是128bit二进制字符串，E是AES-128加密算法，K是密钥

$H_{\bigoplus}(M)=M_1\bigoplus M_2\bigoplus ...\bigoplus M_k$

$MCN(M)=E(K,H_{\bigoplus}(M))$

也就是说，消息验证码是用加密算法加密明文按位异或运算得到的。

甲将明文和MCN发给乙，乙用K将MCN解密得到$H_{\bigoplus}(M)$,然后用M计算$H_{\bigoplus}(M)$，若一致，则可以证明M没有被篡改过。

攻击者可以构造M'，若可以使得$H_{\bigoplus}(M')$和$H_{\bigoplus}(M)$一样，就可以将假消息M'伪造为甲发送的明文M

**数据认证码**

不常用

**密码散列消息认证码**

密码散列消息认证码，HMCN，将密钥信息融入明文，再用散列函数计算散列值，散列函数不同 ，HMCN算法不同

破坏的方法：

* 生日攻击
* 集相交攻击

**数字签名标准**

数字签名标准DSS

加密生成ra sa,用公钥明文和sa计算v，若v和ra相同，则说明消息未被篡改。

没看太懂。
